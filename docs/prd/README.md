# PRD (Product Requirements Document)

## 1. 프로젝트 개요

### 1.1 기본 정보

| 항목 | 내용 |
|------|------|
| 프로젝트명 | 번개장터 클론 - 중고거래 플랫폼 MVP |
| 목적 | P2P 중고 물품 거래 학습 프로젝트 |
| 비전 | "실무 수준의 프로토타입 완성" |
| MVP 기간 | 5-7주 (관리자 페이지 포함) |
| 타겟 | 학습/포트폴리오 (실서비스 준비 아님) |

### 1.2 MVP 목표 (현실화)

Week 7 종료 시:
- ✅ 회원가입: 10-20명 (주변 지인)
- ✅ 상품 등록: 30-50개
- ✅ 거래 완료: 5-10건
- ✅ 관리자 페이지: 상품/유저 관리 가능
- ✅ 배포 완료 (Vercel)

## 2. 타겟 유저 페르소나

### Persona 1: 판매자 (대학생, 23세)
- **니즈**: 빠른 상품 등록 (3분 이내)
- **Pain Point**: 복잡한 폼 싫어함

### Persona 2: 구매자 (직장인, 32세)
- **니즈**: 검색 편의성, 이미지 크게 보기
- **Pain Point**: 가격 흥정 귀찮음

### Persona 3: 관리자 (개발자/운영자, 28세)
- **니즈**: 부적절한 상품 즉시 삭제, 악성 유저 차단, 간단한 통계 확인
- **Pain Point**: SQL 직접 쓰기 번거로움

## 3. MVP 핵심 기능 (5개) ✅ 채팅 제외

### 3.1 회원가입/로그인
- **방식**: 이메일만 (소셜 로그인 제외)
- **보안**: JWT (Access 1h, Refresh 7d)
- **관리자 계정**: 초기 시드 데이터로 1개 생성

### 3.2 상품 CRUD
- **등록**: 제목, 가격, 카테고리(10개), 이미지(1-5장), 설명
- **이미지**: Cloudflare R2 (Presigned URL 업로드)
- **수정/삭제**: 본인 상품만

### 3.3 상품 목록/검색
- **목록**: 최신순 정렬, 무한 스크롤
- **검색**: PostgreSQL Full-text Search (제목만)
- **필터**: 카테고리, 가격 범위

### 3.4 상품 상세
- **UI**: 모달 (Parallel Routes)
- **기능**: 이미지 슬라이드, 판매자 프로필

### 3.5 관리자 페이지
- **접근**: /admin (관리자만, JWT role 체크)
- **기능**:
  - 대시보드: 전체 통계 (유저 수, 상품 수, 거래 완료 수, 오늘 거래 금액, 판매 추이)
  - 상품 관리: 전체 상품 목록, 검색, 상태별 필터, 삭제
  - 유저 관리: 전체 유저 목록, 검색, 계정 상태 변경 (활성/차단)
  - 수수료 관리: 수수료율 설정, 전체/월별 통계, 거래 내역 조회

## 4. Phase 6 추가 기능 (확장 MVP)

### 4.1 UI/UX 개선
- Toast 알림 시스템 (sonner)
- 로딩 스켈레톤 UI
- Next.js Image 최적화
- 에러 바운더리

### 4.2 핵심 거래 기능
- 찜하기 (좋아요) 기능
- 가격 제안 (네고) 기능
- 마이페이지 (내 정보, 내 상품, 구매 내역, 찜 목록, 제안 내역)

### 4.3 검색 개선
- **검색바**: Navbar 중앙 배치, 실시간 검색어 입력, X 버튼 클리어 기능
- **검색 필터**: 카테고리(6개), 가격 범위(최소/최대), 상태(전체/판매중/판매완료)
- **필터 UI**: 접을 수 있는 패널, 활성 필터 배지, 초기화/적용 버튼
- **URL 동기화**: 검색어 및 필터가 URL 쿼리 파라미터로 동기화되어 공유 가능

### 4.4 추가 개선사항
- **확인 모달**: 삭제/구매 등 중요 액션을 위한 재사용 가능한 확인 다이얼로그
- **빈 상태 UI**: 데이터 없을 때 표시할 일관된 EmptyState 컴포넌트 (아이콘 5종 프리셋)
- **모바일 반응형**: 햄버거 메뉴, 모바일 검색바, 터치 친화적 네비게이션

## 5. 제외 기능 (Phase 2로 미룸)

- ❌ 1:1 채팅 (Socket.io)
- ❌ 소셜 로그인 (카카오, 네이버)
- ❌ 실제 결제 (토스페이먼츠)
- ❌ 에스크로
- ❌ SMS/알림톡
- ❌ 후기/평점
- ✅ 다크 모드 (Phase 10.2에서 구현)
- ❌ 복잡한 관리자 기능 (신고 시스템, 분쟁 관리, 감사 로그, 실시간 차트)
- ✅ SEO 기본 최적화 (Phase 10.3에서 구현, JSON-LD는 미구현)
- ❌ PWA

## 5. 카테고리

1. 디지털/가전
2. 패션의류
3. 패션잡화
4. 뷰티/미용
5. 스포츠/레저
6. 생활/가공식품
7. 도서
8. 가구/인테리어
9. 반려동물용품
10. 기타

## 6. 상품 상태

- `FOR_SALE`: 판매중
- `SOLD`: 판매완료
- `DELETED`: 삭제됨

## 7. 사용자 역할

- `USER`: 일반 사용자
- `ADMIN`: 관리자

## 8. 사용자 상태

- `ACTIVE`: 활성
- `BANNED`: 차단됨

---

## 9. 현재 구현 상태 (2025-12-09)

### ✅ MVP 핵심 기능 구현 완료

#### 3.1 회원가입/로그인 ✅
- **Backend**: JWT 인증 모듈 완성 (Access 1h, Refresh 7d)
- **Frontend**: 로그인/회원가입 페이지, Zustand 상태 관리
- **추가 기능**: 빠른 로그인 버튼 (테스트용)
  - 일반 유저: `test@sparkmarket.com` / `user123456`
  - 관리자: `admin@sparkmarket.com` / `admin123456`

#### 3.2 상품 CRUD ✅
- **Backend**: 상품 CRUD API 완성
- **Frontend**: 상품 등록/수정/삭제 페이지
- **이미지**: Cloudflare R2 또는 로컬 스토리지 모드 (최대 5개)
- **상태**: FOR_SALE, SOLD, DELETED

#### 3.3 상품 목록/검색 ✅
- **Backend**: 페이지네이션, 검색, 필터 API
- **Frontend**: 무한 스크롤 (20개씩)
- **필터**: 카테고리, 가격 범위, 검색어, 해시태그

#### 3.4 상품 상세 ✅
- **Frontend**: 상품 상세 페이지
- **기능**: 이미지 갤러리, 판매자 정보, 수정/삭제 권한 체크, 해시태그 표시

#### 3.5 관리자 페이지 ✅
- **접근**: `/admin` (JWT role 체크)
- **대시보드**: 통계 카드 + 차트
  - 전체 유저, 전체 상품, 판매중 상품, 판매완료
  - 오늘 가입 유저, 오늘 등록 상품, 오늘 거래 금액
  - 최근 7일 판매 추이 그래프
  - 최근 30일 유저 가입 추이 그래프
  - 카테고리별 상품 분포 (파이 차트)
  - 상품 상태별 현황 (도넛 차트)
- **상품 관리**: 전체 목록, 검색, 필터, 삭제
- **유저 관리**: 전체 목록, 검색, 차단/활성화
- **수수료 관리**: 수수료율 설정, 전체/월별 통계, 거래 내역 조회

### 📊 구현 진행률

| 기능 | 상태 | 진행률 |
|------|------|--------|
| 회원가입/로그인 | ✅ 완료 | 100% |
| 상품 CRUD | ✅ 완료 | 100% |
| 상품 목록/검색 | ✅ 완료 | 100% |
| 상품 상세 | ✅ 완료 | 100% |
| 관리자 페이지 | ✅ 완료 | 100% |
| **전체 MVP** | ✅ 완료 | 100% |

---

## 10. Phase 8-10 기능 명세 (UX 개선)

### Phase 8: 핵심 UX 개선 ✅ (2025-12-09 완료)

#### 8.1 Navbar "판매하기" 버튼 추가 ✅
- **목적**: 상품 등록 접근성 향상
- **위치**: Navbar 우측, 알림 아이콘 앞
- **디자인**: Primary 색상 버튼 + Plus 아이콘
- **동작**:
  - 로그인 상태: `/products/new`로 이동
  - 비로그인 상태: `/login?returnUrl=/products/new`로 리다이렉트
- **반응형**: 데스크톱 + 모바일 메뉴 모두 표시

#### 8.2 상품 목록 정렬 옵션 ✅
- **정렬 옵션**:
  - 최신순 (기본값)
  - 가격 낮은순
  - 가격 높은순
  - 인기순 (조회수 + 찜 수 가중치)
- **UI**: 탭 버튼 스타일 (SortTabs 컴포넌트)
- **Backend**: `sort` 쿼리 파라미터 추가 (`latest`, `price_asc`, `price_desc`, `popular`)
- **URL 동기화**: 정렬 옵션도 URL 쿼리로 유지

#### 8.3 프로필 이미지 업로드 ✅
- **위치**: `/profile/settings` 페이지 (기존 구현)
- **기능**:
  - 현재 아바타 표시
  - 이미지 선택 (클릭)
  - 미리보기
  - 업로드 및 저장
- **제한**: 최대 5MB, 이미지 파일만 허용
- **Backend**: `POST /images/avatar-presigned-url` API 추가
- **저장**: avatars 폴더로 분리 저장 (R2 또는 로컬)

---

### Phase 9: 상품 상세 개선 ✅ (2025-12-09 완료)

#### 9.1 상품 공유 기능 ✅
- **버튼 위치**: 상품 상세 페이지 제목 옆
- **공유 옵션**:
  - Web Share API 지원 시 네이티브 공유
  - 미지원 시 URL 클립보드 복사
- **피드백**: Toast로 "링크가 복사되었습니다" 표시

#### 9.2 이미지 확대 보기 ✅
- **동작**: 상품 이미지 클릭 시 전체 화면 모달로 확대
- **기능**:
  - 전체 화면 모달 (검은 배경)
  - 좌우 화살표 네비게이션 (여러 이미지일 경우)
  - 썸네일 네비게이션 하단 표시
  - 닫기 버튼 및 ESC 키 지원
  - 좌우 방향키 지원
  - 확대/축소 버튼 (0.5x ~ 3x)
  - 이미지 카운터 표시
- **UI**: ImageZoomModal 컴포넌트 생성

#### 9.3 판매자 다른 상품 보기 ✅
- **위치**: 상품 상세 페이지 하단
- **표시**: 동일 판매자의 다른 판매중 상품 최대 4개
- **UI**: 2x2 그리드 (모바일) / 1x4 그리드 (데스크톱)
- **링크**: "더보기" 클릭 시 `/users/[id]`로 이동
- **Backend**: `seller_id`, `exclude` 쿼리 파라미터 추가

---

### Phase 10: 추가 개선 ✅ (2025-12-09 완료)

#### 10.1 카테고리 페이지 ✅
- **라우트**: `/categories`
- **UI**: 카테고리 그리드 (아이콘 + 이름 + 상품 수)
- **클릭**: `/?category=XXX`로 필터링된 메인 페이지로 이동
- **추가 기능**:
  - 인기 카테고리 섹션 (상품 수 기준 상위 3개)
  - 전체 상품 수 표시
  - 다크 모드 지원

#### 10.2 다크 모드 ✅
- **토글 위치**: Navbar 우측
- **저장**: localStorage + Zustand (persist middleware)
- **구현**: Tailwind `dark:` 클래스 활용
- **시스템 연동**: `prefers-color-scheme` 기본값으로 사용
- **모드**: light / dark / system (3가지)
- **파일**:
  - `stores/themeStore.ts`: 테마 상태 관리
  - `components/providers/ThemeProvider.tsx`: 테마 적용
  - `components/ui/ThemeToggle.tsx`: 토글 버튼

#### 10.3 SEO 기본 최적화 ✅
- **메타 태그**: 각 페이지별 title, description (layout.tsx)
- **OG 태그**: 상품 상세 페이지 동적 OG 태그 (generateMetadata)
- **Twitter Cards**: 상품 공유 시 미리보기
- **sitemap.xml**: `/app/sitemap.ts` - 동적 생성
- **robots.txt**: `/app/robots.ts` - 관리자 페이지 등 크롤링 제외

---

### 🎯 Phase별 우선순위

| Phase | 기능 | 난이도 | 예상 시간 |
|-------|------|--------|----------|
| **8.1** | Navbar 판매하기 버튼 | 쉬움 | 30분 |
| **8.2** | 상품 목록 정렬 | 보통 | 1-2시간 |
| **8.3** | 프로필 이미지 업로드 | 보통 | 1-2시간 |
| **9.1** | 상품 공유 | 쉬움 | 30분 |
| **9.2** | 이미지 확대 | 보통 | 1시간 |
| **9.3** | 판매자 다른 상품 | 쉬움 | 30분 |
| **10.1** | 카테고리 페이지 | 쉬움 | 1시간 |
| **10.2** | 다크 모드 | 보통 | 2-3시간 |
| **10.3** | SEO 최적화 | 보통 | 1-2시간 |

---

### 🚫 제외 기능 (추후 검토)

- 1:1 채팅 (Socket.io) - 별도 Phase로 분리
- 소셜 로그인 (카카오, 네이버)
- 실제 결제 (토스페이먼츠)
- PWA

### 🔗 관련 링크

- **GitHub**: https://github.com/trump360-gif/sparkmarket
- **로컬 Backend**: http://localhost:3003
- **로컬 Frontend**: http://localhost:3002

### 📝 최근 업데이트

#### 2025-12-09
- ✅ **Phase 10 완료: 추가 개선**
  - **10.1**: 카테고리 페이지 (`/categories`)
    - 카테고리별 아이콘, 상품 수 표시
    - 인기 카테고리 섹션 (상위 3개)
    - 다크 모드 지원
  - **10.2**: 다크 모드 구현
    - Zustand + persist로 테마 상태 관리
    - light / dark / system 3가지 모드
    - Navbar에 테마 토글 버튼 추가
    - 주요 컴포넌트에 다크 모드 스타일 적용
  - **10.3**: SEO 기본 최적화
    - layout.tsx: 전역 메타데이터, OG/Twitter 태그
    - 상품 상세 페이지: 동적 generateMetadata
    - sitemap.ts: 동적 sitemap 생성
    - robots.ts: 관리자 페이지 크롤링 제외
- ✅ **Phase 9 완료: 상품 상세 개선**
  - **9.1**: 상품 공유 기능 (Web Share API + 클립보드 복사)
  - **9.2**: 이미지 확대 모달 (ImageZoomModal 컴포넌트)
    - 전체 화면 확대, 좌우 네비게이션, 썸네일, 줌 컨트롤
    - ESC 키 및 좌우 화살표 키보드 지원
  - **9.3**: 판매자 다른 상품 보기
    - Backend: `seller_id`, `exclude` 쿼리 파라미터 추가
    - 상품 상세 하단에 판매자의 다른 상품 최대 4개 표시
- ✅ **Phase 8 완료: 핵심 UX 개선**
  - **8.1**: Navbar에 '판매하기' 버튼 추가 (데스크톱 + 모바일)
  - **8.2**: 상품 목록 정렬 옵션 (최신순/가격 낮은순/가격 높은순/인기순)
    - Backend: sort 쿼리 파라미터 지원
    - Frontend: SortTabs 컴포넌트 (탭 버튼 스타일)
  - **8.3**: 프로필 이미지 업로드 개선
    - Backend: `/images/avatar-presigned-url` API 추가
    - avatars 폴더로 분리 저장

#### 2025-12-06
- ✅ 개발 환경 포트 변경 (충돌 방지)
  - Backend: 3001 → 3003
  - Frontend: 3000 → 3002
- ✅ 로컬 이미지 업로드 모드 추가
  - R2 설정 없이도 로컬 스토리지로 이미지 업로드 가능
  - `backend/public/uploads/` 디렉토리에 저장
  - ServeStatic 모듈로 정적 파일 서빙
- ✅ Seed 데이터 대폭 확장
  - 브랜드 8개 추가 (Apple, Samsung, Nike 등)
  - 해시태그 18개 추가 (중고거래, 깨끗해요, 급처 등)
  - 상품별 해시태그 연결
  - 판매 완료 상품에 대한 트랜잭션 자동 생성
- ✅ 관리자 대시보드 통계 강화
  - 최근 30일 유저 가입 추이 그래프
  - 카테고리별 상품 분포 (파이 차트)
  - 상품 상태별 현황 (도넛 차트)
- ✅ UI 개선
  - ProductCard에 해시태그 표시 (최대 2개)
  - PopularHashtags 컴포넌트 간소화
  - 조회수 아이콘 변경 (👁️ → 눈 SVG)
- ✅ 테스트 코드 수정
  - 모든 spec 파일에 의존성 주입 추가
  - uuid 모듈 mock 추가

#### 2025-11-23
- ✅ Phase 6 완료: 확장 MVP 기능
  - **Phase 6.1**: Toast 알림 시스템 (sonner), 로딩 스켈레톤 UI
  - **Phase 6.2**: 찜하기 기능, 가격 제안 기능, 마이페이지
  - **Phase 6.3**: 검색 개선 (Navbar 검색바, SearchFilters 컴포넌트)
  - **Phase 6.4**: 추가 개선사항 (ConfirmModal, EmptyState, 모바일 반응형)
- ✅ Phase 5.8 완료: 수수료 관리 시스템
  - Database: CommissionSettings, Transaction 모델 추가
  - Backend: Commission 모듈, 수수료율 설정/통계 API
  - 구매 시 수수료 자동 계산 및 Transaction 기록
  - Frontend: 관리자 수수료 관리 페이지 (/admin/commission)
  - Migration: 기존 판매 완료 상품 4건 거래 내역 백필 완료
- ✅ Phase 5.7 완료: 구매 기능, R2 이미지 업로드, 관리자 유저 대시보드
  - 구매 기능 구현 (상태 자동 변경)
  - Cloudflare R2 이미지 업로드 연동 완료
  - 관리자 유저 상세 페이지 구현 (/admin/users/[id])
  - 관리자 대시보드 카드 클릭 네비게이션 추가
  - 관리자 유저 목록 클릭 가능
- ✅ Phase 5.6 완료: 관리자 페이지 고도화 및 상품 상세 기능 추가
  - 상품 조회수/채팅 수 트래킹 기능 추가
  - 관리자 대시보드: 오늘 거래 금액, 최근 7일 판매 그래프
  - 상품 목록에 조회수/채팅 수 표시 (👁️ 💬 아이콘)
  - 관리자 상품 대시보드 페이지 구현 (/admin/products/[id])
  - 상품 상세 페이지에 구매하기/문의하기 버튼 추가
- ✅ 프론트엔드 전체 구현 완료
- ✅ 코드 전체 검토 및 오류 수정
- ✅ 빠른 로그인 버튼 추가 (테스트 편의성 개선)
