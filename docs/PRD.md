# 스파크마켓 PRD (Product Requirements Document)

## 1. 제품 개요

### 1.1 제품명
스파크마켓 (SparkMarket)

### 1.2 제품 설명
스파크마켓은 중고 물품 거래를 위한 웹 기반 마켓플레이스입니다. 사용자들이 안전하고 편리하게 중고 물품을 사고팔 수 있는 플랫폼을 제공합니다.

### 1.3 기술 스택
- **Frontend**: Next.js 14, React 18, TypeScript, TailwindCSS, Zustand
- **Backend**: NestJS 11, Prisma 5.22, PostgreSQL
- **Storage**: AWS S3 (이미지 저장)
- **Authentication**: JWT (Access Token + Refresh Token)

---

## 2. 핵심 기능

### 2.1 사용자 관리
- 회원가입/로그인 (이메일 기반)
- JWT 기반 인증
- 프로필 관리 (닉네임, 아바타, 바이오)
- 사용자 역할 (USER, ADMIN)

### 2.2 상품 관리
- 상품 등록/수정/삭제
- 다중 이미지 업로드 (AWS S3)
- 상품 상태 관리
  - `NEW`: 새상품
  - `LIKE_NEW`: 거의 새것
  - `USED`: 사용감 있음
  - `WELL_USED`: 사용감 많음
  - `FOR_PARTS`: 부품용
- 거래 방법 설정
  - `DIRECT`: 직거래
  - `DELIVERY`: 택배
  - `BOTH`: 둘 다
- 직거래 희망 지역 설정
- 브랜드 태그
- 해시태그

### 2.3 검색 & 필터링
- 키워드 검색 (제목, 설명)
- 카테고리 필터
- 가격대 필터
- 상품 상태 필터
- 거래 방법 필터
- 브랜드 필터
- 해시태그 검색

### 2.4 찜하기
- 상품 찜하기/취소
- 찜 목록 관리
- 가격 인하 알림 (찜한 상품)

### 2.5 가격 제안
- 구매자가 판매자에게 가격 제안
- 제안 수락/거절
- 72시간 자동 만료
- 관련 알림

### 2.6 거래 & 리뷰
- 거래 기록 관리
- 수수료 자동 계산 (기본 5%)
- 양방향 리뷰 시스템 (구매자↔판매자)
- 별점 (1-5점)

### 2.7 팔로우 시스템
- 사용자 팔로우/언팔로우
- 팔로워/팔로잉 목록
- 팔로우한 사용자의 신상품 피드
- 새 팔로워 알림

### 2.8 신고 & 차단
- 사용자/상품 신고
  - 신고 사유: 스팸, 사기, 부적절한 콘텐츠, 금지 품목, 가품, 기타
- 사용자 차단
- 차단 목록 관리

### 2.9 키워드 알림
- 관심 키워드 등록
- 카테고리/가격대 필터 설정
- 매칭 상품 등록 시 알림

### 2.10 최근 본 상품
- 상품 조회 기록 저장
- 최근 본 상품 목록 (최대 50개)
- 개별/전체 삭제

### 2.11 브랜드 & 카테고리
- 브랜드 목록/검색
- 인기 브랜드 표시
- 브랜드별 상품 필터
- 동적 카테고리 관리 (관리자)
- 카테고리 계층 구조

### 2.12 해시태그
- 상품에 해시태그 추가
- 인기 해시태그 목록
- 해시태그로 상품 검색

### 2.13 알림 시스템
- 알림 타입
  - `PRICE_OFFER_RECEIVED`: 가격 제안 받음
  - `PRICE_OFFER_ACCEPTED`: 제안 수락됨
  - `PRICE_OFFER_REJECTED`: 제안 거절됨
  - `REVIEW_RECEIVED`: 리뷰 받음
  - `PRODUCT_APPROVED`: 상품 승인됨
  - `PRODUCT_REJECTED`: 상품 거절됨
  - `KEYWORD_ALERT`: 키워드 알림
  - `PRICE_DROP`: 가격 인하 알림
  - `NEW_FOLLOWER`: 새 팔로워
  - `FOLLOWED_USER_PRODUCT`: 팔로우한 사용자 신상품
- 읽음/미읽음 관리

### 2.14 콘텐츠 검토
- 금지어 자동 필터링
- 의심 키워드 검사
- 가격 이상 탐지
- 관리자 승인/거절

### 2.15 관리자 기능
- 대시보드 (통계, 차트)
- 사용자 관리 (목록, 상태 변경, 밴)
- 상품 관리 (목록, 삭제, 검토)
- 상품 검토 (승인/거절)
- 수수료율 관리
- 브랜드/카테고리 관리
- 신고 처리

### 2.16 마이페이지 기능
- 내 상품 목록
- 찜 목록 관리
- 거래 내역 조회
- 받은/보낸 가격 제안 관리
- 팔로워/팔로잉 목록 (토글 탭)
- 키워드 알림 관리
- 최근 본 상품
- 차단 사용자 관리

### 2.17 공개 프로필 페이지
- 사용자 공개 프로필 조회
- 판매 중인 상품 목록
- 받은 리뷰 목록
- 팔로우/차단 기능

---

## 3. 사용자 플로우

### 3.1 구매자 플로우
1. 회원가입/로그인
2. 상품 검색/탐색
3. 상품 상세 확인
4. 찜하기 또는 가격 제안
5. 거래 진행
6. 리뷰 작성

### 3.2 판매자 플로우
1. 회원가입/로그인
2. 상품 등록
3. 가격 제안 확인/응답
4. 거래 진행
5. 리뷰 작성

---

## 4. 비즈니스 규칙

### 4.1 거래 규칙
- 본인 상품 구매/제안 불가
- 가격 제안은 정가보다 낮은 가격만 가능
- 72시간 내 응답 없으면 제안 자동 만료
- 거래당 수수료 부과 (기본 5%)

### 4.2 리뷰 규칙
- 거래 완료 후 리뷰 작성 가능
- 거래당 방향당 1개의 리뷰만 작성 가능
- 1-5점 별점 + 텍스트 (최대 500자)

### 4.3 콘텐츠 규칙
- 금지 품목 등록 불가 (불법, 성인, 무기 등)
- 의심 콘텐츠는 관리자 검토 필요
- 허위 신고 시 제재 가능

---

## 5. 향후 계획 (미구현)

### 5.1 실서버 연동 필요 기능
- 실시간 채팅 (WebSocket)
- 안전결제 시스템 (PG사 연동)
- 배송 추적 (택배사 API)
- 본인 인증 (휴대폰/계좌)
- 푸시 알림

### 5.2 추가 고려 기능
- AI 상품 등록 (이미지 분석)
- 검수 서비스
- 포인트/리워드 시스템
- 위치 기반 직거래

---

## 6. 버전 히스토리

| 버전 | 날짜 | 설명 |
|------|------|------|
| 1.0 | 2024-11-28 | Phase 7 - 확장 기능 추가 |
| 1.1 | 2025-11-28 | Phase 7 완료 - 버그 수정 및 UI 개선 |
| 1.2 | 2025-12-12 | Phase 8 완료 - 팔로우/팔로잉 상태 동기화 버그 수정 |

---

## 7. 구현 완료 항목 (Tasks)

### Phase 1-5: 핵심 MVP ✅
- [x] 회원가입/로그인 (JWT 인증)
- [x] 상품 CRUD
- [x] 이미지 업로드 (AWS S3)
- [x] 상품 검색/필터링
- [x] 찜하기 기능
- [x] 가격 제안 시스템
- [x] 거래/리뷰 시스템
- [x] 알림 시스템

### Phase 6: 확장 MVP ✅
- [x] 팔로우/언팔로우 시스템
- [x] 사용자/상품 신고
- [x] 사용자 차단
- [x] 키워드 알림
- [x] 최근 본 상품
- [x] 브랜드 시스템
- [x] 해시태그
- [x] 동적 카테고리 관리
- [x] 콘텐츠 검토 (금지어/의심어)
- [x] 관리자 대시보드
- [x] 수수료 관리

### Phase 7: UI/UX 개선 및 버그 수정 ✅
- [x] 마이페이지 팔로워/팔로잉 토글 탭
- [x] 관리자 유저 차단 기능 수정 (DTO 검증)
- [x] 관리자 상품 목록 테이블 레이아웃 개선
- [x] API 응답 포맷 통일 (PaginatedResponse)
- [x] 에러 핸들링 개선

### Phase 8: 버그 수정 ✅
- [x] 팔로우/팔로잉 상태 동기화 버그 수정
  - 다른 페이지에서 팔로우 후 마이페이지 카운트 미갱신 → Zustand 전역 상태로 해결
  - 프로필 페이지 재방문 시 팔로우 버튼 상태 초기화 → 팔로우 상태 캐싱 구현
  - 팔로잉 목록 표시 안됨 → API 응답 데이터 구조 호환성 수정

### 미구현 항목 (Future)
- [ ] 실시간 채팅
- [ ] 안전결제
- [ ] 배송 추적
- [ ] 본인 인증
- [ ] 푸시 알림
- [ ] AI 상품 등록
